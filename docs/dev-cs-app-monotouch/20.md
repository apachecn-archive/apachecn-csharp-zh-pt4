## 第二十章

## 发布到 App Store

所以，你已经苦读了这本书，你已经构建了一个很棒的应用程序，现在你已经准备好将它放入苹果的应用程序商店——这是 iOS 应用程序开发者的最高成就。好吧，让我们先覆盖一些不碍事的东西，这样你提交到 App Store 就能尽可能的顺畅。

提交到应用商店可能是一个令人沮丧的过程，也可能是制作一个盈利应用的快速、无痛的一步。本章的目标是为您的应用程序提供一些指导，以便您的体验更接近于后者。

在本章中，我们将介绍 App Store 提交的以下途径:

*   审查指南符合性
*   构建用于分发的应用程序
*   提交到 App Store

本章假设你已经是苹果开发者计划的成员。如果你不是，你需要在`developer.apple.com`注册才能在 App Store 发布应用。

### 审查指南符合性

当您准备好发布到 App Store 时，您需要做的第一件事是查看苹果的指导方针，并确保您的应用程序符合这些指导方针。你可以在苹果开发者网站上找到这些指南:`https://developer.apple.com/appstore/resources/approval/guidelines.html`。

**注:**重要的是要明白，这些指导方针仅仅是，指导方针。它们不是严格的规则。虽然坚持这些肯定会提高你的应用程序通过 App Store 发行的几率，但苹果是不可预测的。有许多公开的好的申请没有被批准的例子。不幸的是，这是苹果的游乐场，它绝对统治着它。

该指南受保密协议的约束，Apple 保留更改文档的权利。因此，我不能在这里复制它们，但以下是为 App Store 创建应用程序时的大忌:

*   **没有明确的内容:**史蒂夫·乔布斯一直强烈反对在 iOS 应用生态系统中允许色情内容。因此，如果你的应用程序有任何不在教育背景下的明确内容，它将被拒绝。这是苹果的一个特别敏感的症结所在，所以我建议你谨慎行事。
*   **没有私有 API 调用:**有许多方法可以在底层 io 中调用，这些方法是没有文档记录的，因此不是公共 API。如果您坚持使用 MonoTouch APIs，这不是问题，因为它们只包装了公共 API。然而，如果你手动调用未记录的 Objective-C 选择器，并且你的应用程序审查者发现了，你的应用程序很有可能被拒绝，因为苹果已经自动扫描在你的二进制文件中寻找这些调用。
*   **无重大 bug:**据苹果公司称，bug(更确切地说是崩溃 bug)是拒绝进入 App Store 的最常见原因。在提交之前，您应该彻底测试并稳定您的应用程序。有些审查者似乎比其他人更彻底，但一般来说，你应该确保你的应用程序在正常使用过程中没有任何重大错误或崩溃。
*   **功能缺失/不正确:**除了崩溃错误，苹果提到的另一个被拒绝的常见原因是功能缺失或功能与描述不符。您应该确保您的应用程序像宣传的那样工作；如果你说你的应用有一些特殊的功能，确保它有。

这些是 App Store 提交审核过程中的一些最大的症结，但指南中还涵盖了许多其他内容。请务必检查它们，并确保您的应用程序符合它们。

#### 苹果博客

除了公布的指导方针，苹果还维护着一个公共博客，该博客不断更新关于被应用商店接受的提示，以及关于变化和一些常见失误的提醒。请务必在`[http://developer.apple.com/news/ios/appstoretips](http://developer.apple.com/news/ios/appstoretips)`查看。

### 配货大楼

在您查看了指南并确保您的应用程序是稳定的并且没有违反 App Store 规则之后，是时候构建它以供提交了。

为提交而构建与为开发而构建没什么不同，除了你必须用苹果认可的发行身份来签名。一般流程如下:

1.  使用 Apple 创建分发预置描述文件。
2.  安装分发预置描述文件。
3.  在 MonoDevelop 中创建一个发行版构建配置。
4.  配置捆绑签名。
5.  在 MonoDevelop 中构建并压缩项目。

让我们检查一下这些步骤。

#### 创建和安装分发预置描述文件

为了在 App Store 中构建分发应用程序，您需要做的第一件事是创建一个用于分发的预置描述文件并安装它。预置描述文件在 iOS 预置门户中创建和管理，可在 developer.apple.com 找到。登录，导航到门户，并执行以下操作:

1.  **创建应用程序 ID:** 如果您还没有为您的应用程序创建应用程序 ID，请创建一个。在门户网站中，点击左侧导航栏上的`App IDs`，按照说明创建一个新的应用 ID。如果您想要在多个应用程序之间共享钥匙串信息，您可以对整个应用程序套件使用单个应用程序 ID。
2.  **创建分发配置文件:**在门户中，点击`Provisioning`，然后选择`Distribution`选项卡。点击`New Profile`按钮，按照说明创建新的个人资料。确保选择您刚刚创建的应用程序 ID。
3.  **安装分发预置描述文件:**从`Window`菜单启动 Xcode 并打开管理器。点击左侧导航上的`Provisioning Profiles`，然后点击主信息窗格中的`Refresh`。它会提示您登录 Apple developer，并下载和安装您新创建的分发预置描述文件。

一旦您创建并安装了新的分发配置文件，您需要在 MonoDevelop 中创建一个构建配置来使用它。

#### 添加分发构建配置

MonoDevelop 在构建时会自动找到并使用您的开发者分发配置文件/身份。但是如果要为 App Store 进行分发，就必须使用自己的分发身份，分发身份会用 Apple 认可的密钥对应用进行签名，进行分发。

要创建发行版构建配置，在 MonoDevelop 中右键单击您的解决方案并选择`Options`。然后，在`Build ![images](img/.jpg) Configuration`下，添加一个名为`Distribution`之类的新配置，并选择`iPhone`作为平台。参见[图 20–1](#fig_20_1)。

![images](img/.jpg)

**图 20–1。** *在 MonoDevelop 中创建分发配置*

**注意:**我们选择了 iPhone 作为平台，但这实际上意味着我们不是在使用模拟器，而是在使用设备。真的，选择应该是 iOS 模拟器或 iOS 设备，希望 MonoTouch 团队在未来更新 MonoDevelop 以反映这一点并避免混淆。

在我们创建了我们的发行版构建配置之后，我们需要对它进行配置，以使用我们之前创建的发行版配置文件。

#### 配置分发包签名

要配置新的发行版构建配置以使用发行版配置文件，在 MonoDevelop 中右键单击应用程序项目，选择`Options`，然后选择左侧的`iPhone Bundle Signing`。接下来，将配置更改为分发配置(我们在上一步中创建的配置)，然后为 identity 选择您的分发身份以及您新安装的分发配置文件(参见[Figure 20–2](#fig_20_2))。

![images](img/.jpg)

**图 20–2。** *配置分发包签名*

现在您已经准备好构建您的应用程序了。

#### 建筑

我们的应用程序现在可以构建了，但是因为我们添加了一个新的构建配置，所以我们需要确保我们的所有配置选项都是为新配置设置的。这也是确保我们使用最新的 iOS SDK 进行构建的好机会。苹果只会接受用最新 RTM(非测试版)SDK 构建的应用。

要配置您的构建，打开应用程序的项目选项并选择`iPhone Build`。将配置更改为`Distribution`并验证您的构建配置(参见[图 20–3](#fig_20_3))。

![images](img/.jpg)

**图 20–3。** *配置分发构建*

确保如果你的构建需要任何额外的参数，它们都在这个配置中。完成后，点击`OK`。

配置好发行版构建设置后，现在可以构建和压缩应用程序包了。这里有两个选择:您可以手动完成，也可以让 MonoDevelop 为您完成。我将介绍这两种方法，这样您就知道最简单的方法(让 MonoDevelop 为您做这件事)，并且通过自己做这件事来了解实际发生了什么。

在任一场景中，您首先需要从 MonoDevelop 工具栏的活动配置下拉列表中选择`Distribution` | `iPhone`(参见[图 20–4](#fig_20_4))。

![images](img/.jpg)

**图 20–4。** *选择配送构建目标*

这确保了在构建您的应用程序时，它使用您之前配置的分布概要文件。

##### 让 MonoDevelop 为您构建和压缩

要让 MonoDevelop 创建压缩包，从菜单中选择`Project![images](img/.jpg)Zip App Bundle`，然后选择保存压缩文件的位置(参见[Figure 20–5](#fig_20_5))。

![images](img/.jpg)

**图 20–5。** *选择保存压缩应用包的位置*

这将构建您的应用程序，然后将其压缩。

##### 手动构建和压缩

如果您不想在 MonoDevelop 中使用该工具，您可以像平常一样简单地构建。然后，在构建应用程序之后，您需要获取结果。你将上传到苹果的 APK 文件。右键单击您的项目并选择`Open Containing Folder`。然后导航到 iPhone/Distribution 文件夹，找到您的应用程序的应用文件(参见[Figure 20–6](#fig_20_6))。

![images](img/.jpg)

**图 20–6。** *提交申请文件*

右键单击应用程序并从上下文菜单中选择`Compress…`。这将创建一个您可以上传的 zip 文件。

**注:**这是复制您的。dSYM 文件保存到一个安全的地方，这样你就可以用符号表示苹果公司的事故报告。

现在您已经有了应用程序包的 zip 文件(使用任何一种方法)，是时候提交您的应用程序了！

### 通过 iTunes Connect 提交您的应用

应用程序通过 iTunes Connect 提交，你可以在[http://itunesconnect.Apple.com](http://itunesconnect.Apple.com)找到它。iTunes Connect 是所有与 App Store 相关的事物的管理门户。它也是您查找销售报告、管理用户等的地方。

为了提交您的申请，您需要首先完成以下工作:

*   **配置用户(可选):**当你第一次在 iOS 程序中注册成为开发者时，你提供了关于你自己的信息。该信息用于创建管理员用户，该用户对管理 iTunes Connect 中的内容拥有完全控制权。如果您想将其他人添加到您的 iTunes Connect 会员，您可以。您甚至可以为不同的人配置特定的权限，以便只有特定的人拥有特定的能力。例如，您可以设置一个可以管理财务事务(如查看报告、设置应用程序价格等)的人，以及另一个可以提交应用程序的人。若要配置用户，请从 iTunes Connect 主屏幕中选取`Manage Users`。
*   **接受合同(仅适用于付费应用):**如果你打算在应用商店出售你的应用(而不是免费赠送)，你需要申请一份合同并接受它。从 iTunes Connect 主屏幕中，选择`Contracts, Tax, and Banking`，然后按照提供的步骤请求并接受您计划使用的服务的合同。
*   **设置银行、税务和联系信息(仅适用于付费应用):**在您接受合同后，您需要设置您的联系方式、银行和税务信息，以便 Apple 知道将您的应用收入存放在哪里，验证您的法律地位(并报告税务)，最后，如果需要，他们会联系您。您可以在请求合同的同一位置配置这些东西(它们将是合同被接受后可用的选项)。
*   **在 iTunes Connect 中准备好您的应用程序:**要提交您的应用程序，从 iTunes Connect 主页中选择`Manage Your Applications`，然后选择`Add New App`，并按照说明进行操作。

这些工作完成后，您就可以提交了。要提交申请，您需要运行 Application Loader 应用程序。要启动此功能，请打开 Spotlight，键入“应用程序加载器”并启动应用程序(参见[Figure 20–7](#fig_20_7))。

![images](img/.jpg)

**图 20–7。** *应用加载器*

如果您已经在 iTunes Connect 中设置了该应用程序，当您点按“下一步”时，您应该会看到类似于[Figure 20–8](#fig_20_8)的屏幕。

![images](img/.jpg)

**图 20–8。** *在应用加载器中选择要提交的应用*

选择了要提交的应用程序后，点击`Next`并按照说明进行操作。它会让你上传之前创建的 zip 文件，并在成功提交后通知你。

就这样！现在，您只需等待申请被批准(如果您遵循了这里的建议，应该会批准)。

### 申请驳回争议解决

所以你很努力地做了一份很棒的申请，你提交了申请，但是被拒绝了。别担心。大多数拒绝是因为容易解决的原因。

如果你的申请被拒绝，你将被告知为什么被拒绝。最常见的拒绝是由主要的错误或功能缺失或不完整引起的。如果是这种情况，只需解决问题并重新提交应用程序的新版本。

然而，如果你觉得你的拒绝是没有根据的，苹果现在有一个应用审查委员会，允许你提交上诉，解释为什么你觉得拒绝是没有根据的。您可以在苹果开发者网站`[http://developer.apple.com/appstore/guidelines.html](http://developer.apple.com/appstore/guidelines.html)`上找到上诉表格的链接。

最后，如果你已经使用了上诉程序，而苹果仍然不批准你的申请，你可以考虑公开你的拒绝。不过要注意:苹果讨厌在媒体上曝光自己(即使这是有根据的)，它的拒绝信受你签署开发者计划时签署的 NDA 的约束。然而，尽管如此，在很多情况下，公众对应用程序被拒的批评导致苹果公司改变了他们的决定(或者更多情况下，悄悄批准提交)。

### 总结

在本章中，我们介绍了准备您的应用程序进行提交的过程，包括创建分发预置描述文件、签署捆绑包和构建分发。然后，您了解了 iTunes Connect，这是苹果管理的门户网站，提供所有与 App Store 相关的内容。最后，我们讲述了提交应用程序的过程，以及如果被拒绝该怎么办。

在下一章，我们将看看从你的 IOs 应用程序调用 web 服务。